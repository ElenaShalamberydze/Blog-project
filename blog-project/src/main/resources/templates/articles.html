<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Articles</title>
</head>
<body>

<h1>Blog</h1>
<hr width="20%" align="left"/>
<table sec:authorize="isAnonymous()">
    <td>
        <form th:action="@{/login}" method="get">
            <input type="submit" value="Login"/>
        </form>
    </td>
    <td>
        <form th:action="@{/registration}" method="get">
            <input type="submit" value="Registration"/>
        </form>
    </td>
    <td>
        <a href="/auth/forgot_password">Forgot password</a>
    </td>
</table>
<br/>
<div sec:authorize="isAuthenticated()">
<form th:action="@{/logout}" method="post">
    <input type="submit" value="Logout"/>
</form>
</div>
<br/>
        <table sec:authorize="isAuthenticated()">
            <tr>
                <td><a href="/articles">main</a></td>
            </tr>
            <tr>
                <td><a href="/my">show my articles</a></td>
            </tr>
            <tr>
                <td><a href="/tags-cloud">tags cloud</a></td>
            </tr>
        </table>
<br/>

<div sec:authorize="isAuthenticated()">
<form action="#" th:action="@{/articles}" method="post">
    <label for="title">Title</label>
    <input type="text" name="title" id="title" placeholder="Title" value="" required>
    <label for="text">Text</label>
    <input type="text" name="text" id="text" placeholder="Text" value="" required>
    <label for="tags">Tags</label>
    <input type="text" name="tags" id="tags" placeholder="Tags" value="">
    <input type="submit" value="Add article">
</form>
</div>
<br />
<div th:if="${!articles.isEmpty()}">

    <div th:if="${articles.totalPages > 0}" class="pagination"
         th:each="pageNumber : ${pageNumbers}">
        <a th:href="@{/articles(size=${articles.size}, page=${pageNumber-1})}"
           th:text=${pageNumber}
           th:class="${pageNumber==articles.number + 1} ? active"></a>
    </div>

        <table th:each="article : ${articles.getContent()}">
            <tr>
                <th th:text="${article.title}"></th>
                <td th:text="${article.text}"></td>
            </tr>
            <tr>
                <table>
                    <td align="left" th:each="tag : ${article.tags}"><em th:text="${tag.name}"/></td>
                </table>
            </tr>
            <tr>
                <td th:text="${article.updatedAt != null} ? ${article.updatedAt} : ${article.createdAt}"></td>
            </tr>
            <tr>
                <td th:text="${article.user.firstName} + ' ' + ${article.user.lastName} "></td>
            </tr>
            <tr>
                <td>
                    <a sec:authorize="isAuthenticated()" th:href="@{/articles/{id}/comments(id=${article.id})}">show with comments</a>
                </td> <br/> <br/>
            </tr> <br/>
        </table>
</div>
</body>
</html>